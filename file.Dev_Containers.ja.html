<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: Dev_Containers.ja
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Dev_Containers.ja";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Dev_Containers.ja</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-E9-96-8B-E7-99-BA-E3-82-B3-E3-83-B3-E3-83-86-E3-83-8A-28Development+Containers-29-E3-81-AE-E5-88-A9-E7-94-A8">開発コンテナ(Development Containers)の利用</h1>

<p>このリポジトリでは <a href="https://containers.dev/">開発コンテナ(Dev Container)</a>をサポートしています。これを使うと、ローカルの環境を汚すことなく、RedAmberに必要なツール一式を含んだ環境を準備することができます。この環境には、Ruby、Apache Arrow、RedAmberのソースツリー、GitHub CI、サンプルデータセット、IRubyカーネルを含んだJupyter Labなどが含まれていて、簡単でメンテナンスしやすく、かつ再利用性が高い構成になっています。</p>

<p>RedAmber用のDev Containerは、<code>.devcontainer</code> ディレクトリに必要な設定が書かれています。現在の実装では、Dockerfileを使用せず、Dev Containers用のUbuntuベースイメージに、Dev Container Featuresを使って、Python、GitHub CIの環境を加えて作っています。Ruby は Container ができてから走らせるスクリプトでインストールしています。</p>

<p>Dockerfileで作るのと比べて、- User周りの設定を自動的にやってくれる- 言語環境をFeatureとして個別に追加することができる - PythonではJupyter Labをオプションとして追加できる - Rubyは<code>rbenv</code>をインストールしてあって後から別のバージョンを追加できる - Quartoを動かせる環境を簡単に追加でき、Jupyter notebookのソース管理に利用できる</p>

<p>等の利点があります。</p>

<p>ここでは代表的な利用法を2つ紹介します。</p>

<h2 id="label-1.+GitHub+Codespaces-E3-81-A7-E3-82-AF-E3-83-A9-E3-82-A6-E3-83-89-E4-B8-8A-E3-81-AEVM-E3-82-92-E3-83-96-E3-83-A9-E3-82-A6-E3-82-B6-E3-81-8B-E3-82-89-E4-BD-BF-E3-81-86">1. GitHub Codespacesでクラウド上のVMをブラウザから使う</h2>

<h3 id="label-E5-BF-85-E8-A6-81-E3-81-AA-E3-82-82-E3-81-AE">必要なもの</h3>

<p>GitHubアカウントにサインインしている必要があります。</p>

<h3 id="label-E6-B3-A8-E6-84-8F">注意</h3>

<p>以下の手順では、Codespacesを起動するあなたのアカウントのクォータを消費します。GitHub Freeに対しては120時間/月・コア(2コアでは60時間)、ストレージ15GB/月が無料で使用できます。使用状況については <a href="https://github.com/settings/billing">Billing and plans</a>のCodespacesの項を参照してください。</p>

<h3 id="label-E6-89-8B-E9-A0-86">手順</h3>
<ul><li>
<p>GitHubの<a href="https://github.com/red-data-tools/red_amber">RedAmberのリポジトリ</a>を開いてください。</p>
</li><li>
<p>開発を行う場合は、フォークしてご自身のリポジトリを作り、それを開いてください。</p>
</li><li>
<p>リポジトリ内の「&lt;&gt;Code」ボタン、「Codespaces」タブにある、「Create codespace on main」ボタンを押して新しいCodespacesを作成してください。</p>
</li><li>
<p>既にCodespacesがある場合は、該当するコンテナ名をクリックすると再接続できます。</p>
</li><li>
<p>Codespacesの作成には時間がかかります。「View log」をクリックしてぼーっとログを眺めるか、コーヒーを淹れに行くとよいでしょう。</p>
</li><li>
<p>今後、GitHub Container Registoryにキャッシュを保存して、速く起動できるようにする予定です。</p>
</li><li>
<p>VS Code for ブラウザでリポジトリが開きます。</p>
</li></ul>

<p>動作の確認は、下の<a href="#動作の確認">動作の確認</a>を参照してください。</p>

<h3 id="label-E8-A9-B3-E7-B4-B0">詳細</h3>

<p>より詳しくは、<a href="https://docs.github.com/ja/codespaces/developing-in-codespaces/creating-a-codespace-for-a-repository">(GitHub Docs)リポジトリの codespace を作成する</a>を参照してください。</p>

<h2 id="label-2.+-E3-83-AD-E3-83-BC-E3-82-AB-E3-83-AB-E3-81-AB-E3-82-AF-E3-83-AD-E3-83-BC-E3-83-B3-E3-81-97-E3-81-9F-E3-83-AA-E3-83-9D-E3-82-B8-E3-83-88-E3-83-AA-E2-80-95-E3-81-8B-E3-82-89Dev+Container-E3-82-92-E7-AB-8B-E3-81-A1-E4-B8-8A-E3-81-92-E3-80-81VS+Code-E3-81-A7-E4-BD-BF-E3-81-86">2. ローカルにクローンしたリポジトリ―からDev Containerを立ち上げ、VS Codeで使う</h2>

<h3 id="label-E5-BF-85-E8-A6-81-E3-81-AA-E3-82-82-E3-81-AE">必要なもの</h3>
<ul><li>
<p>Visual Studio Code (October 2020 Release 1.51以降)</p>
</li></ul>

<p>GitHub Codespaces 拡張機能をインストールして、GitHub 資格情報を使用してサインインする必要があります。<a href="https://docs.github.com/ja/codespaces/developing-in-codespaces/using-github-codespaces-in-visual-studio-code#prerequisites">GitHub Docs - GitHub Codespaces - 前提条件</a>を参照して設定を済ませておいてください。</p>
<ul><li>
<p>Docker</p>
</li><li>
<p>Windows</p>

<p>Windows 10 Pro/Enterprise では Docker Desktop 2.0 以降。Windows 10 Home (2004+) では、Docker Desktop 2.3 以降と WSL 2 バックエンド。</p>
</li><li>
<p>Mac</p>

<p>Docker Desktop 2.0 以降</p>
</li><li>
<p>Linux</p>

<p>Docker CE/EE 18.06 以降と Docker Compose 1.21 以降</p>
</li><li>
<p>Git</p>
</li></ul>

<h3 id="label-E6-89-8B-E9-A0-86">手順</h3>
<ul><li>
<p>ローカルに RedAmberリポジトリのクローンを作成します。</p>
</li><li>
<p>開発を行う場合は、フォークしてご自身のリポジトリを作り、それをクローンしてください。</p>
</li></ul>

<p><code>  $ git clone https://github.com/red-data-toolsまたは貴方のアカウント名/red_amber.git </code> または、GitHub CLIで、 <code>  $ gh repo clone red-data-toolsまたは貴方のアカウント名/red_amber </code> とします。</p>
<ul><li>
<p>作成したローカルのリポジトリフォルダーをVS Codeで開きます。 <code>  $ code red_amber </code></p>
</li><li>
<p>コンテナーで開く</p>
</li></ul>

<p>今のフォルダーをコンテナーで再度開きます。</p>
<ul><li>
<p>左下隅のステータスバーのリモートホスト表示（今はローカルなので「&gt;&lt;」の後ろに何もついていない）をクリックするとリモートウィンドウを開くオプションが表示されるので、「コンテナーで再度開く」を選択します。</p>
</li><li>
<p>コンテナーの構築が開始されます</p>
</li></ul>

<p>最初の構築には、数分かかることがあります。それ以降の構築は高速になります。 構築が完了すると、左下隅のステータスバーのリモートホスト表示にコンテナー名が表示されます。</p>

<h2 id="label-E5-8B-95-E4-BD-9C-E3-81-AE-E7-A2-BA-E8-AA-8D">動作の確認</h2>

<h3 id="label-E3-82-BF-E3-83-BC-E3-83-9F-E3-83-8A-E3-83-AB-E3-81-A7-E3-82-A4-E3-83-B3-E3-82-B9-E3-83-88-E3-83-BC-E3-83-AB-E3-81-95-E3-82-8C-E3-81-A6-E3-81-84-E3-82-8B-E3-83-84-E3-83-BC-E3-83-AB-E3-82-92-E7-A2-BA-E8-AA-8D-E3-81-99-E3-82-8B">ターミナルでインストールされているツールを確認する</h3>

<p>ターミナルが開いていない場合は、 <code>CTRL + `</code> で開いてください。</p>

<p>下記のコマンドを実行して、ツールがインストール済みであることを確かめてください。</p>

<p>“‘shell $ ruby -v –jit $ rbenv versions $ gem -v $ gem list $ bundler -v $ iruby -v</p>

<p>$ python –version $ pip –version $ pip list $ pipenv –version $ jupyter –version $ jupyter kenelspec list</p>

<p>$ git -v $ git config user.name $ gh –version “‘</p>

<p>ユーザーは、<code>vscode</code> という名前で、<code>uid/gid</code> はローカルのユーザーと同じになっています。</p>

<p><code>shell   $ id </code></p>

<h3 id="label-RedAmber-E3-81-AE-E3-83-86-E3-82-B9-E3-83-88-E3-82-92-E8-B5-B0-E3-82-89-E3-81-9B-E3-81-A6-E3-81-BF-E3-82-8B">RedAmberのテストを走らせてみる</h3>

<p><code>shell  $ bundle exec rake </code></p>

<h3 id="label-REPL-E3-81-A7RedAmber-E3-82-92-E8-A9-A6-E3-81-99">REPLでRedAmberを試す</h3>

<p>プリロードされたデータセットを使って、irbの環境でRedAmberの動作を確認できます。初回はRed Datasetsのデータをロードするため少し時間がかかります。</p>

<p>“‘ruby $ rake example</p>

<p>(snip)</p>

<pre class="code ruby"><code class="ruby">  81: # Welcome to RedAmber example!
  82: # This environment will offer these pre-loaded datasets:
  83: #   penguins, diamonds, iris, starwars, simpsons_paradox_covid,
  84: #   mtcars, band_members, band_instruments, band_instruments2
  85: #   import_cars, comecome, rubykaigi, dataframe, subframes
</code></pre>

<p>=&gt; 86: binding.irb</p>

<p>irb(main):001:0&gt; “‘</p>

<p>irbの動作を途中で止めているので、ここで表示されているデータセットが変数に読み込まれています。</p>

<p><code>ruby  irb(main):001:0&gt; import_cars  =&gt;  #&lt;RedAmber::DataFrame : 5 x 6 Vectors, 0x0000000000010914&gt;       Year    Audi     BMW BMW_MINI Mercedes-Benz      VW    &lt;int64&gt; &lt;int64&gt; &lt;int64&gt;  &lt;int64&gt;       &lt;int64&gt; &lt;int64&gt;  0    2017   28336   52527    25427         68221   49040  1    2018   26473   50982    25984         67554   51961  2    2019   24222   46814    23813         66553   46794  3    2020   22304   35712    20196         57041   36576  4    2021   22535   35905    18211         51722   35215 </code></p>

<p>名前空間の<code>RedAmber</code> はインクルードされています。 <code>ruby  irb(main):002:0&gt; VERSION  =&gt; &quot;0.5.0&quot;  irb(main):003:0&gt; Arrow::VERSION  =&gt; &quot;12.0.1&quot; </code></p>

<p><code>@</code>を入力すると最初のブレークポイントに戻ることができます。</p>

<p><code>exit</code> を入力するとirbを抜けます。</p>

<h3 id="label-Jupyter+Lab-E3-81-A7RedAmber-E3-82-92-E8-A9-A6-E3-81-99">Jupyter LabでRedAmberを試す</h3>

<p>Python と IRuby カーネルを持ったJupyter Labをブラウザで起動することができます。</p>

<p><code>shell  $ rake jupyter </code></p>

<p>で、ローカルの8888ポートでブラウザが立ち上がります。</p>
<ul><li>
<p>Notebookフォルダーとして、<code>doc/notebook</code> が割り当てられていて、そこには2つの<code>.ipynb</code>ファイルがあります。</p>
<ul><li>
<p><code>red_amber.ipynb</code> : <code>README.md</code> で紹介している操作例。</p>
</li><li>
<p><code>examples_of_red_amber.ipynb</code> : 様々な例を集めたもの。</p>
</li></ul>
</li><li>
<p><code>require &#39;red_amber&#39;</code> は <code>lib</code> 以下のソースを読み込んでいます。</p>
</li></ul>

<h2 id="label-Quarto+-E3-81-AB-E3-82-88-E3-82-8B-E3-83-89-E3-82-AD-E3-83-A5-E3-83-A1-E3-83-B3-E3-83-88-E6-93-8D-E4-BD-9C">Quarto によるドキュメント操作</h2>

<p><a href="https://quarto.org/">Quarto</a>はオープンソースの科学技術ドキュメントの出版システムです。</p>

<p>この環境では、RedAmber の動作例を活用するために Quarto CLI を使っています。</p>

<pre class="code ruby"><code class="ruby">---
title: Quartoを利用したドキュメント管理
---
flowchart LR
    id1[&quot;Source management
        (.qmd)&quot;]
    id2[&quot;Analyze and edit by JupyterLab
        (.ipynb)&quot;]
    id3[&quot;Publish document
        (.pdf)&quot;]

    id1 -- convert --&gt; id2 -- convert --&gt;  id1
    id2 -- render --&gt; id3
    id1 -- render --&gt; id3
</code></pre>
<ul><li>
<p>Quartoのドキュメント <code>qmd</code> 形式でソース管理できます。</p>
</li><li>
<p><code>.qmd</code>ファイルを Jupyter notebook ファイル(<code>.ipynb</code>)に変換して、 Jupyter Lab上で編集したりデータ解析ができます。</p>
</li><li>
<p><code>pdf</code>形式 に変換することができます。</p>
</li></ul>

<h3 id="label-Quarto+-E3-81-AE-E5-8B-95-E4-BD-9C-E3-82-92-E7-A2-BA-E8-AA-8D-E3-81-99-E3-82-8B">Quarto の動作を確認する</h3>

<p>Quarto のバージョンと動作環境をチェックするには次のようにします。</p>

<pre class="code ruby"><code class="ruby">$ quarto -v
$ quarto check
</code></pre>

<p>ヘルプを表示するには下記のようにします。</p>

<pre class="code ruby"><code class="ruby">$ quarto --help
$ quarto render --help
</code></pre>

<h3 id="label-E3-82-BD-E3-83-BC-E3-82-B9-E3-81-8B-E3-82-89Jupyter+Notebook-E3-82-92-E7-94-9F-E6-88-90-E3-81-99-E3-82-8B">ソースからJupyter Notebookを生成する</h3>

<p><code>.qmd</code>ソースファイルから <code>.ipynb</code> を生成するには、</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake quarto:convert
</code></pre>

<p>とします。<code>doc/qmd</code>フォルダー以下にあるqmdソースファイルから <code>doc/notebook</code>フォルダーに<code>ipynb</code>ノートブックファイルが作成されます。</p>

<p>より一般的には、</p>

<pre class="code ruby"><code class="ruby">$ quarto convert ソースファイル.qmd
$ quarto convert ソースファイル.qmd --output 出力先ノートブック.ipynb
</code></pre>

<p>上の書き方では、出力ファイルはソースファイルの拡張子を <code>.ipynb</code>に変えて、ソースファイルと同じディレクトリに保存されます。</p>

<p>下記のコマンドは、Notebookを作成後、Jupyter Labを開きます。</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake jupyter
</code></pre>

<h3 id="label-Jupyter+Notebook-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-82-92qmd-E5-BD-A2-E5-BC-8F-E3-81-A7-E4-BF-9D-E5-AD-98-E3-81-99-E3-82-8B">Jupyter Notebookファイルを<code>qmd</code>形式で保存する</h3>

<p>編集したJupyter Notebookをqmd形式に変換できます。</p>

<pre class="code ruby"><code class="ruby">$ quarto convert ノートブック.ipynb
$ quarto convert ノートブック.ipynb --output 出力先ソースファイル.qmd
</code></pre>

<h3 id="label-E3-81-9D-E3-81-AE-E4-BB-96-E3-81-AE-E6-B4-BB-E7-94-A8-E6-96-B9-E6-B3-95">その他の活用方法</h3>

<p>下記のコマンドは<code>doc/qmd</code>フォルダー以下にあるqmdソースファイルを<code>ipynb</code>に変換し、実行してpdfを作成します。</p>

<pre class="code ruby"><code class="ruby">$ bundle exec rake quarto:test
</code></pre>

<p>下記は<code>doc/notebook</code>フォルダーを含めたrakeの生成物を消去します。</p>

<pre class="code ruby"><code class="ruby">$ rake clean
</code></pre>

<p>Quartoについてより詳しくは、コマンドラインヘルプ(<code>quarto --help</code>)、または<a href="https://quarto.org/">Quarto</a>公式ページをご覧ください。</p>

<h3 id="label-E8-AC-9D-E8-BE-9E">謝辞</h3>

<p>Quarto の利用は、西田孝三さんの2022年度のRubyアソシエーション開発助成事業プロジェクト『RubyDataエコシステムへのQuartoの導入とその利用の促進のためのコミュニティ活動』 がきっかけとなりました。この場をお借りして感謝申し上げます。</p>
</div></div>

      <div id="footer">
  Generated on Thu Feb  1 23:24:07 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.3.0).
</div>

    </div>
  </body>
</html>